
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Show of Hands</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
    <script
        src="https://code.jquery.com/jquery-3.1.1.js"
        integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="worker.js"></script>

</head>
<body>
<button id='yeabtn'>YEA</button><button id="naybtn">NAY</button>
  <!-- <div class='container' style="display:show;">
  	<span id="voteName"></span><br>
    <span id="yeaG" style='color:#DCC6E0'></span>
    <span style='color:#DCC6E0'>Yea</span>
    <span id="yeaP" style='color:#DCC6E0'>%</span>
    <span id="nayG" style='color:purple'></span>
    <span  style='color:purple'>Nay</span>
    <span id="nayP" style='color:purple'>%</span><br>
    <span id="total" style='color:purple'></span><br>
    <div id='plink'>
      <canvas id="myCanvas" width=320px; height=320px;>
      </canvas>
    </div><br>
   	<button style="height:49px; border:1px solid black; border-radius: 10px; background-color: rgba(0,0,0,.5); width:100%;">End the Vote</button>
  </div> -->

  <script src="/socket.io/socket.io.js"></script>
<script>
/* jslint esversion:6 */
var socket = io('/');
var voteID = window.location.pathname;
voteID = voteID.replace(["/"],"");

socket.emit('voteID',voteID);
//
//
// //////////////// INDEX.html /////////////
//     $.get(
//       "/votepush",
//       function( res ) {
//         var votes = [];
//         var quill ;
//         var voteDisplay = [];
//         var select = document.getElementById("selectVote");
//         var timeStamp = new Date($.now());
//         timeStamp = timeStamp.valueOf();
//
//         var exp = res
//         exp.reverse();
//         function twentyFour (exp){
//           for(var i in exp) { //need to reverse loop chrono
//             if((timeStamp - exp[i].Time)<604800000){//votes need to be less than a week old (milliseconds)
//               votes.push(exp[i]);
//               var print = "<p id='title';>"+votes[i].Name+" : </p><br><p id='stat'>"+votes[i].Yea+"% Yea | "+votes[i].Nay+"% Nay | "+ votes[i].total+ " people voted"+ "</p><br>";
//               voteDisplay = voteDisplay.concat(print);
//             }
//             $('#experiment').html(voteDisplay);
//           }
//         }
//         twentyFour(exp);
//
//         var display = JSON.stringify(votes);
//         $('#votename').keydown(function(event) {
//             if (event.keyCode == 13) {
//                 var name = $("#votename").val();
//                 $("#votename").val(name);
//                 $("#votename").val("");
//                 var time = new Date($.now());
//                 time = time.valueOf();
//                 if(name.length > 60){
//                   // $('#warning').css("display:show");
//                   alert("That name is too long!");
//                 } else {
//                   var raw = {"name": name,"time": time};
//                   votes.reverse();
//                   votes.push(raw);
//                   votes = JSON.stringify(votes);
//                 }
//       $.post('/voteSend',
//         {votes:votes},
//           function(data,status){
//             //location.reload();
//             console.log(status);
//             //$("myForm")[0].reset();
//       });
//           return false;
//         }
//       });
//     });
/////////////end INDEX.html///////


/////////////CANVAS.html///////////


$.get( "/getVotes",  function( data ) {




    $.get( "/getSession",  function( data ) {
        $('#voteName').html(data[voteID]);
    });



    data = data[voteID];
    $('#total').html("/ "+data.connectCounter+" people connected");
    $('#yeaG').html(data.yea);
    $('#yeaP').html(Math.floor(data.yea/data.connectCounter*100)+" %");
    $('#nayG').html(data.nay);
    $('#nayP').html(Math.floor(data.nay/data.connectCounter)*100+" %");

////CANVAS////////
            // var elem = document.getElementById('myCanvas'),
            //     elemLeft = elem.offsetLeft,
            //     elemTop = elem.offsetTop,
            //     ctx = elem.getContext('2d'),
            //     elements = [];
            //
            // elem.addEventListener('click', function(event) {
            //     var x = event.pageX - elemLeft,
            //         y = event.pageY - elemTop;
            // var dynHeight = $('#myCanvas').height()/2;
            //     elements.forEach(function(element) {
            //         var voted = false;
            //         if (!voted) {
            //             if(y<dynHeight){
            //                 //var voteID = window.location.pathname;
            //                 //voteID = voteID.replace(["/"],"");
            //                 //socket.emit("vote",{"voteID":voteID,"vote":"nay"});
            //                 voted = true;
            //              } else {
            //                  //var voteID = window.location.pathname;
            //                  //voteID = voteID.replace(["/"],"");
            //                 socket.emit("vote",{"voteID":voteID,"vote":"nay"});
            //                 voted = true;
            //             }
            //         }
            //     });
            // }, false);
            // var dynHeight = $('#myCanvas').height();
            // // Add element.
            // elements.push({
            //     color: '#DCC6E0',
            //     width: 320,
            //     height: 160,
            //     top: 0,
            //     left: 0,
            //     name: "yea"
            // },{
            //
            //     color: 'purple',
            //     width: 320,
            //     height: 160,
            //     top: 160,
            //     left: 0,
            //     name: "Nay"
            // });
            //
            // // Render elements.
            // elements.forEach(function(element) {
            //     ctx.fillStyle = element.color;
            //     ctx.fillRect(element.left, element.top, element.width, element.height);
            //
            // });
/////////////////// END CANVAS/////////////



        });


        socket.on('update', data => {
            console.log(data);
            $('#total').html("/ "+data.connectCounter+" People Connected");
             $('#yeaG').html(data.yea);
             $('#yeaP').html(Math.floor(data.yea/data.connectCounter*100)+" %");
             $('#nayG').html(data.nay);
             $('#nayP').html(Math.floor(data.nay/data.connectCounter)*100+" %");
        });

$('#yeabtn').click(function(){
    var voteID = window.location.pathname;
    voteID = voteID.replace(["/"],"");
    socket.emit("vote",{"voteID":voteID,"vote":"yea"});
});
$('#naybtn').click(function(){
    var voteID = window.location.pathname;
    voteID = voteID.replace(["/"],"");
    socket.emit("vote",{"voteID":voteID,"vote":"nay"});
});
    socket.on('news', function (data) {
      console.log(data);
      socket.emit('my other event', { my: 'data' });
    });
</script>
</body>
</html>
