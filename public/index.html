
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Show of Hands</title>
    <link rel="stylesheet" type="text/css" href="style.css">
<!--     <script type="text/javascript" src="worker.js"></script> -->
  <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
    <script
  src="https://code.jquery.com/jquery-3.1.1.js"
  integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
  crossorigin="anonymous"></script>
</head>
<body>
  <div class='container'>
    <span id="yeaG" style='color:#DCC6E0'></span>
    <span style='color:#DCC6E0'>Yea</span>
    <span id="yeaP" style='color:#DCC6E0'>%</span>
    <span id="nayG" style='color:purple'></span>
    <span  style='color:purple'>Nay</span>
    <span id="nayP" style='color:purple'>%</span><br>
    <span id="total" style='color:purple'></span><br>
    <div id='plink'>
      <canvas id="myCanvas" width=320px; height=320px;>
      </canvas>
    </div>
    <span id="warning">TOO LONG OF A TITLE!!!!</span>
    <div>
      <input id="votename" type="text" class="commentarea" placeholder="name this vote and save >>" onsubmit="reset()" >
    </div>
    <div id="display">
    </div>
    <h1 id="title" style="font-weight: 900">STORED VOTES...</h1>
    <div id="experiment">
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
<script>
/* jslint esversion:6 */

    var socket = io();
    var voted = false;

$.get(
  "/votepush",
  function( res ) {
    var votes = [];
    var quill ;
    var voteDisplay = [];
    var select = document.getElementById("selectVote");
    var timeStamp = new Date($.now());
    timeStamp = timeStamp.valueOf();

    var exp = res
    exp.reverse();
    function twentyFour (exp){
      for(var i in exp) { //need to reverse loop chrono
        if((timeStamp - exp[i].Time)<604800000){//votes need to be less than a week old (milliseconds)
          votes.push(exp[i]);
          var print = "<p id='title';>"+votes[i].Name+" : </p><br><p id='stat'>"+votes[i].Yea+"% Yea | "+votes[i].Nay+"% Nay | "+ votes[i].total+ " people voted"+ "</p><br>";
          voteDisplay = voteDisplay.concat(print);
        }
        $('#experiment').html(voteDisplay);
      }
    }
    twentyFour(exp);

    var display = JSON.stringify(votes);
    $('#votename').keydown(function(event) {
        if (event.keyCode == 13) {
            var name = $("#votename").val(); 
            $("#votename").val(name); 
            $("#votename").val("");
            var time = new Date($.now());
            time = time.valueOf();
            if(name.length > 60){
              // $('#warning').css("display:show");
              alert("That name is too long!");
            } else {
              var raw = {"name": name,"time": time};
              votes.reverse();
              votes.push(raw);
              votes = JSON.stringify(votes);
            }
  $.post('/voteSend',
    {votes:votes},
      function(data,status){
        //location.reload();
        console.log(status);
        //$("myForm")[0].reset();
  });
      return false;
    }
  });
});



socket.on('update-msg', function (msg) {
    total = msg.data;
   // console.log(total);
    $('#total').html(" / " + msg.data + " people connected");
});


var elem = document.getElementById('myCanvas'),
    elemLeft = elem.offsetLeft,
    elemTop = elem.offsetTop,
    ctx = elem.getContext('2d'),
    elements = [];

var ctx = elem.getContext("2d");
    ctx.font = "30px Arial";
    ctx.fillText("Hello World",10,50);

// Add event listener for `click` events.
elem.addEventListener('click', function(event) {
    var x = event.pageX - elemLeft,
        y = event.pageY - elemTop;
    elements.forEach(function(element) {
        if (voted === false) {
            if(y<160){
                console.log(y);
                socket.emit("button click");
                socket.on('recv click', (yea) => {
                    $('#yeaG').html(yea);
                });
                voted = true;
             } else {
                console.log(y);
                socket.emit("button click2");
                socket.on('recv click2', (nay) => {
                    $('#nayG').html(nay);
                });
                voted = true;
            }
        }
    });
}, false);

// Add element.
elements.push({
    color: '#DCC6E0',
    width: 320,
    height: 160,
    top: 0,
    left: 0,
    name: "yea"
},{

    color: 'purple',
    width: 320,
    height: 160,
    top: 160,
    left: 0,
    name: "Nay"
});

// Render elements.
elements.forEach(function(element) {
    ctx.fillStyle = element.color;
    ctx.fillRect(element.left, element.top, element.width, element.height);

});

function checkYea (){
  socket.on('recv click', (yea) => {
      $('#yeaG').html(yea + "# Yea ");
  });
}

function checkNay (){
  socket.on('recv click2', (nay) => {
      $('#nayG').html(nay + "# Nay ");
  });
}

socket.on('recv percY', (yeaP) => {
    $('#yeaP').html(yeaP + "%");
});

  socket.on('recv percN', (nayP) => {
    $('#nayP').html(nayP + "%");
});


//setInterval(populate(),1000);
// setInterval(socket.emit(checkYea()), 1000);
// setInterval(socket.emit(checkNay()), 1000);
</script>
</body>
</html>