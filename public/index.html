
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Show of Hands</title>
    <link rel="stylesheet" type="text/css" href="style.css">
<!--     <script type="text/javascript" src="worker.js"></script> -->
  <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
    <script
  src="https://code.jquery.com/jquery-3.1.1.js"
  integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
  crossorigin="anonymous"></script>
</head>
<body>
<div class='container'>
  <span id="yeaG" style='color:#DCC6E0'></span>
  <span style='color:#DCC6E0'>Yea</span>
  <span id="yeaP" style='color:#DCC6E0'>%</span>
  <span id="nayG" style='color:purple'></span>
  <span  style='color:purple'>Nay</span>
  <span id="nayP" style='color:purple'>%</span><br>
  <span id="total" style='color:purple'></span><br>
    <!-- <textarea id="votename" class="commentarea" placeholder="new vote name"></textarea> -->

<!--     <button id="namesub">Create</button><br>
    <form id="myForm">
      <select id="selectVote">
        <option>Currents Votes</option>
      </select>
    </form> -->
  <div id='plink'>
    <canvas id="myCanvas" width=450px; height=450px;>
    </canvas>
  </div>
  <div>
    <input id="votename" type="text" class="commentarea" placeholder="name this vote and save >>" onsubmit="reset()" >
  </div>
  <div id="display">
  </div>
  <div id="experiment">
  </div>
</div>

  <script src="/socket.io/socket.io.js"></script>
<script>
/* jslint esversion:6 */
    var socket = io();
    var voted = false;
    // var total = 0;
    // var yeaG = 0;
    // var nayG = 0;
    // var votes = [];

$.get(
  "/votepush",
  function( res ) {
    var votes = [];
    var select = document.getElementById("selectVote");
    var timeStamp = new Date($.now());
    timeStamp = timeStamp.valueOf();

    function twentyFour (res){
      for(var i = 0; i < res.length; i++) {//votes need to be less than 24 hours
        if((timeStamp - res[i].Time)<604800000){
          votes.push(res[i]);
        }
      }
    }
    twentyFour(res);


          //return votes[i].Name +" = " + " Yea: " + votes[i].Yea + " Nay: " + votes[i].Nay + " Voters " + votes[i].total;
    //     function present(votes){
    //     for(var i = 0; i< votes.length; i++){
    //       return(votes[i].Name +" = " + " Yea: " + votes[i].Yea + " Nay: " + votes[i].Nay + " Voters " + votes[i].total);
    //     }
    //   }

    // console.log(present(votes));
    //$('#experiment').html(votes);

    var display = JSON.stringify(votes);
    $('#display').html(display);
    $('#votename').keydown(function(event) {
        if (event.keyCode == 13) {
            var name = $("#votename").val(); 
            $("#votename").val(name); 
            $("#votename").val("");
            var time = new Date($.now());
            time = time.valueOf();
            var raw = {"name": name,"time": time};
            //console.log(typeof raw);
            votes.push(raw);
            votes = JSON.stringify(votes);
            
  $.post('/voteSend',
    {votes:votes},
      function(data,status){
        //location.reload();
        console.log(status);
        //$("myForm")[0].reset();
  });
      return false;
    }
  });
});



socket.on('update-msg', function (msg) {
    total = msg.data;
   // console.log(total);
    $('#total').html(" / " + msg.data + " people connected");
});


var elem = document.getElementById('myCanvas'),
    elemLeft = elem.offsetLeft,
    elemTop = elem.offsetTop,
    ctx = elem.getContext('2d'),
    elements = [];

var ctx = elem.getContext("2d");
    ctx.font = "30px Arial";
    ctx.fillText("Hello World",10,50);

// Add event listener for `click` events.
elem.addEventListener('click', function(event) {
    var x = event.pageX - elemLeft,
        y = event.pageY - elemTop;
    elements.forEach(function(element) {
        // if (y > element.top && y < element.top + element.height && x > element.left && x < element.left + element.width) {
        //     alert('clicked an element');
        if (voted === false) {
            if(y<250){
                voted = true;
                socket.emit("button click");
                socket.on('recv click', (yea) => {
                    $('#yeaG').html(yea);
                });
             } else {
                socket.emit("button click2");
                socket.on('recv click2', (nay) => {
                    $('#nayG').html(nay);
                });
                voted = true;
            }
        }
    });
}, false);

// Add element.
elements.push({
    color: '#DCC6E0',
    width: 500,
    height: 250,
    top: 0,
    left: 0,
    name: "yea"
},{

    color: 'purple',
    width: 500,
    height: 250,
    top: 250,
    left: 0,
    name: "Nay"
});

// Render elements.
elements.forEach(function(element) {
    ctx.fillStyle = element.color;
    ctx.fillRect(element.left, element.top, element.width, element.height);

});

function checkYea (){
  socket.on('recv click', (yea) => {
      $('#yeaG').html(yea + "# Yea ");
  });
}

function checkNay (){
  socket.on('recv click2', (nay) => {
      $('#nayG').html(nay + "# Nay ");
  });
}

  socket.on('recv percY', (yeaP) => {
      $('#yeaP').html(yeaP + "%");
  });

    socket.on('recv percN', (nayP) => {
      $('#nayP').html(nayP + "%");
  });


// elements[0].fillText("Yea",200,100);
// // elements[0].ctx.font = "50px Helvetica";

//setInterval(populate(),1000);
// setInterval(socket.emit(checkYea()), 1000);
// setInterval(socket.emit(checkNay()), 1000);
</script>
</body>
</html>